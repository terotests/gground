(function(){var t={},e=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},i=function(t,e,n,a,s,r,o,d){var _,u=this;if(!(u instanceof i))return new i(t,e,n,a,s,r,o,d);var l=[t,e,n,a,s,r,o,d];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){_=t.apply(u,l)}),"function"==typeof _){if(_._classInfo.name!=i._classInfo.name)return new _(t,e,n,a,s,r,o,d)}else if(_)return _;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};i._classInfo={name:"edge"},i.prototype=new e,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.edge=i,this.edge=i):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.edge=i:this.edge=i}.call(new Function("return this")());var n=function(){!function(t){t.getRole=function(){return this._role},t.id=function(){return this._model.id},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._dataObj=t,this._model=t}),t.setRole=function(t){this._role=t}}(this)},a=function(t,e,i,n,s,r,o,d){var _,u=this;if(!(u instanceof a))return new a(t,e,i,n,s,r,o,d);var l=[t,e,i,n,s,r,o,d];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){_=t.apply(u,l)}),"function"==typeof _){if(_._classInfo.name!=a._classInfo.name)return new _(t,e,i,n,s,r,o,d)}else if(_)return _;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};a._classInfo={name:"dataClass"},a.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.dataClass=a,this.dataClass=a):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.dataClass=a:this.dataClass=a}.call(new Function("return this")());var s=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._dataObj=t,this._model=t})}(this)},r=function(t,e,i,n,a,s,o,d){var _,u=this;if(!(u instanceof r))return new r(t,e,i,n,a,s,o,d);var l=[t,e,i,n,a,s,o,d];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){_=t.apply(u,l)}),"function"==typeof _){if(_._classInfo.name!=r._classInfo.name)return new _(t,e,i,n,a,s,o,d)}else if(_)return _;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};r._classInfo={name:"dataTag"},r.prototype=new s,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.dataTag=r,this.dataTag=r):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.dataTag=r:this.dataTag=r}.call(new Function("return this")());var o=function(){!function(t){t.getRoleId=function(){return this._roleId},t.id=function(){return this._model.id},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._dataObj=t,this._model=t}),t.setRoleId=function(t){this._roleId=t}}(this)},d=function(t,e,i,n,a,s,r,o){var _,u=this;if(!(u instanceof d))return new d(t,e,i,n,a,s,r,o);var l=[t,e,i,n,a,s,r,o];if(u.__factoryClass)if(u.__factoryClass.forEach(function(t){_=t.apply(u,l)}),"function"==typeof _){if(_._classInfo.name!=d._classInfo.name)return new _(t,e,i,n,a,s,r,o)}else if(_)return _;u.__traitInit?u.__traitInit.forEach(function(t){t.apply(u,l)}):"function"==typeof u.init&&u.init.apply(u,l)};d._classInfo={name:"dataNode"},d.prototype=new o,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.dataNode=d,this.dataNode=d):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.dataNode=d:this.dataNode=d}.call(new Function("return this")());var _=function(){!function(t){var e;t._createClassType=function(t,i){var n=this;return new e(function(e){var s=0;n._dbNode.findOrCreate({classname:t,name:i}).then(function(t){t.options.isNewRecord?t.updateAttributes({created:n.time(),updated:n.time(),creator:n.userid(),updater:n.userid(),parentid:s}).then(function(){e(a(t,n))}):e(a(t,n))})})},t._sumTest=function(){this._dbRelation.sum("double_value",{where:{semantic_id:9}}).then(function(t){console.log("The sum was ",t)})},t.createClass=function(t){return this._createClassType("/model/classes",t)},t.createNode=function(t){return this._createClassType("/model/nodes",t)},t.createRole=function(t){return this._createClassType("/model/roles",t)},t.createTag=function(t){return this._createClassType("/model/tags",t)},t.createUser=function(t){return this._createClassType("/model/users",t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){function t(t){return t>=0&&10>t?"0"+t.toString():t>-10&&0>t?"-0"+(-1*t).toString():t.toString()}e=require("promise"),Date.prototype.toMysqlFormat||(Date.prototype.toMysqlFormat=function(){return this.getUTCFullYear()+"-"+t(1+this.getUTCMonth())+"-"+t(this.getUTCDate())+" "+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())});var i=require("sequelize"),n=require("./ggroundSetup.js"),a=new i(n.db,n.username,n.password,n.setup);this._db=i,this._dbNode=a.define("node",{id:{type:i.INTEGER,primaryKey:!0,autoIncrement:!0},created:{type:i.DATE},updated:{type:i.DATE},creator:{type:i.INTEGER},updater:{type:i.INTEGER},orderid:{type:i.INTEGER},parentid:{type:i.INTEGER},classname:{type:i.STRING(40)},objid:{type:i.INTEGER,defaultValue:0},name:{type:i.STRING(128)},draftspace:{type:i.INTEGER,defaultValue:0},archived:{type:i.INTEGER,defaultValue:0}},{timestamps:!1,indexes:[{fields:["classname","name"]},{fields:["parentid"]},{fields:["parentid","classname"]},{fields:["target_id","target_class_id","semantic_id","source_id","semantic_id","time_start","time_end"]}]}),this._dbNode.sync(),this._dbRelation=a.define("node_relation",{id:{type:i.INTEGER,primaryKey:!0,autoIncrement:!0},source_id:{type:i.INTEGER},source_class_id:{type:i.INTEGER},semantic_id:{type:i.INTEGER},time_start:{type:i.DATE},time_end:{type:i.DATE},double_value:{type:i.FLOAT},decimal_value:{type:i.DECIMAL},target_id:{type:i.INTEGER},target_class_id:{type:i.INTEGER}},{timestamps:!1,indexes:[{fields:["source_id","source_class_id","semantic_id"]},{fields:["source_id","semantic_id","target_id"]},{fields:["source_id","semantic_id","target_id","time_start","time_end"]},{fields:["source_id","source_class_id","semantic_id","target_id","target_class_id"]},{fields:["source_id","source_class_id","semantic_id","target_id","target_class_id","time_start","time_end"]},{fields:["target_id","target_class_id","semantic_id"]},{fields:["target_id","target_class_id","semantic_id","source_id","semantic_id","time_start","time_end"]}]}),this._dbRelation.sync(),this._dbRelationJournal=a.define("node_relation_journal",{id:{type:i.INTEGER,primaryKey:!0,autoIncrement:!0},relation_id:{type:i.INTEGER},journal_time:{type:i.DATE},user_id:{type:i.INTEGER},removed:{type:i.INTEGER,defaultValue:0},source_id:{type:i.INTEGER},source_class_id:{type:i.INTEGER},semantic_id:{type:i.INTEGER},time_start:{type:i.DATE},time_end:{type:i.DATE},double_value:{type:i.FLOAT},decimal_value:{type:i.DECIMAL},target_id:{type:i.INTEGER},target_class_id:{type:i.INTEGER}},{timestamps:!1,indexes:[{fields:["relation_id","user_id"]},{fields:["source_id","source_class_id","semantic_id"]},{fields:["source_id","semantic_id","target_id"]},{fields:["source_id","semantic_id","target_id","time_start","time_end"]},{fields:["source_id","source_class_id","semantic_id","target_id","target_class_id"]},{fields:["source_id","source_class_id","semantic_id","target_id","target_class_id","time_start","time_end"]},{fields:["target_id","target_class_id","semantic_id"]},{fields:["target_id","target_class_id","semantic_id","source_id","semantic_id","time_start","time_end"]}]}),this._dbRelationJournal.sync()}),t.nodeInRole=function(){var t,i,n=this,n=this;return new e(function(e){this.createRole(roleName).then(function(t){return i=t,n.createUser(userName)}).then(function(n){t=n,t.setRole(i),e(t)})})},t.relation=function(t,i,n,a){var s,r,o,d,_,u=t.split("/"),l=i.split("/"),c=a.split("/"),f=this,n=n||{};return new e(function(t){f._createClassType("/model/"+u[0],u[1]).then(function(t){return s=t,f.createRole(u[2])}).then(function(t){return r=t,f._createClassType("/model/"+l[0],l[1])}).then(function(t){return _=t,f._createClassType("/model/"+c[0],c[1])}).then(function(t){return o=t,f.createRole(c[2])}).then(function(e){d=e;var i={source_id:s.id(),source_class_id:r.id(),semantic_id:_.id(),time_start:f.time(),time_end:f.time(),double_value:n.value||0,decimal_value:n.value||0,target_id:o.id(),target_class_id:d.id()};n.start&&(i.time_start=n.start.toMysqlFormat?n.start.toMysqlFormat():n.start,i.time_end=n.end.toMysqlFormat?n.end.toMysqlFormat():n.end),f._dbRelation.create(i).then(function(e){t(e)})})})},t.sumsOf=function(t,i,n,a){var s,r,o,d,_,u=t.split("/"),l=i.split("/"),c=a.split("/"),f=this;return new e(function(t){f._createClassType("/model/"+u[0],u[1]).then(function(t){return s=t,u[2]?f.createRole(u[2]):null}).then(function(t){return r=t,f._createClassType("/model/"+l[0],l[1])}).then(function(t){return _=t,f._createClassType("/model/"+c[0],c[1])}).then(function(t){return o=t,c[2]?f.createRole(c[2]):null}).then(function(e){d=e;var i={source_id:s.id(),semantic_id:_.id(),target_id:o.id()};d&&(i.target_class_id=d.id()),r&&(i.source_class_id=r.id()),f._dbRelation.sum("double_value",{where:i}).then(function(e){t(e)})})})},t.time=function(){return(new Date).toMysqlFormat()},t.userid=function(){return 1},t.userInRole=function(t,i){var n,a,s=this,s=this;return new e(function(e){this.createRole(i).then(function(e){return a=e,s.createUser(t)}).then(function(t){n=t,n.setRole(a),e(n)})})}}(this)},u=function(t,e,i,n,a,s,r,o){var d,_=this;if(!(_ instanceof u))return new u(t,e,i,n,a,s,r,o);var l=[t,e,i,n,a,s,r,o];if(_.__factoryClass)if(_.__factoryClass.forEach(function(t){d=t.apply(_,l)}),"function"==typeof d){if(d._classInfo.name!=u._classInfo.name)return new d(t,e,i,n,a,s,r,o)}else if(d)return d;_.__traitInit?_.__traitInit.forEach(function(t){t.apply(_,l)}):"function"==typeof _.init&&_.init.apply(_,l)};u._classInfo={name:"gg"},u.prototype=new _,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.gg=u,this.gg=u):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.gg=u:this.gg=u}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());